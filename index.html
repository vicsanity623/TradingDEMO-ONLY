<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Goku: Saiyan Ascension - RPG</title>
    
    <!-- PWA MANIFEST & SETTINGS -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050505">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="IMG_0061.png">

    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Orbitron:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- STYLES -->
    <link rel="stylesheet" href="style.css">

    <!-- ASSET PRELOADING -->
    <link rel="preload" as="image" href="IMG_0061.png">
    <link rel="preload" as="image" href="IMG_0081.png">
    <link rel="preload" as="image" href="hb_b.png">
    <link rel="preload" as="image" href="IMG_0206.png">

    <!-- GAME SCRIPTS -->
    <script src="strategy.js" defer></script>
    <script src="skills.js" defer></script>
    <script src="gear.js" defer></script>
    <script src="soul.js" defer></script>
    <script src="battle.js" defer></script>
    <script src="hub.js" defer></script>
    <script src="game.js" defer></script>
</head>
<body onload="initGame()">

    <!-- Fallback -->
    <noscript>
        <div style="color: red; text-align: center; padding: 20px;">
            FATAL ERROR: Scouter indicates JavaScript is disabled. Please enable it to play!
        </div>
    </noscript>

    <div id="loader">
        <div class="load-title">POWERING UP...</div>
        <div class="load-bar"><div id="load-progress" class="load-fill"></div></div>
    </div>

    <!-- LEVEL UP MODAL -->
    <div id="levelup-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:3000; flex-direction:column; align-items:center; justify-content:center;">
        <div style="font-family:'Bangers'; color:#FFD700; font-size:3.5rem; text-shadow:2px 2px black; margin-bottom:20px; animation: popUp 0.5s;">LEVEL UP!</div>
        <div style="position:relative; width:150px; height:150px; margin-bottom:20px;">
            <div style="position:absolute; width:100%; height:100%; border-radius:50%; background:radial-gradient(circle, rgba(255,215,0,0.6), transparent); animation:pulseGreen 1.5s infinite;"></div>
            <img id="lvl-up-img" src="IMG_0061.png" alt="Level Up Form" style="width:100%; height:100%; object-fit:contain; position:relative; z-index:2;">
        </div>
        <div style="font-family:'Orbitron'; color:white; font-size:1.5rem; margin-bottom:15px;">LV <span id="lvl-up-old">1</span> ‚ûî <span id="lvl-up-new" style="color:#00ff00;">2</span></div>
        <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:10px; width:80%; max-width:300px; text-align:center; border:1px solid #555;">
            <div style="color:#ff3e3e; margin:5px 0;">HP: <span id="lvl-stats-hp"></span> <span style="color:#00ff00;">(+250)</span></div>
            <div style="color:#3498db; margin:5px 0;">ATK: <span id="lvl-stats-atk"></span> <span style="color:#00ff00;">(+5)</span></div>
            <div style="color:#2ecc71; margin:5px 0;">DEF: <span id="lvl-stats-def"></span> <span style="color:#00ff00;">(+2)</span></div>
        </div>
        <button onclick="closeLevelUp()" style="margin-top:25px; padding:10px 40px; background:linear-gradient(to bottom, #f1c40f, #f39c12); border:none; border-radius:8px; color:white; font-family:'Bangers'; font-size:1.5rem; cursor:pointer;">CONTINUE</button>
    </div>

    <div id="ready-msg" class="ready-banner">READY?</div>

    <nav>
        <button id="tab-char" class="active" onclick="showTab('char')">HUB</button>
        <button id="tab-battle" onclick="showTab('battle')">BATTLE</button>
    </nav>

    <!-- HUB SCREEN -->
    <div id="view-char" class="screen active-screen">
        <div class="hub-overlay">
            <!-- UPDATED: Added onclick to open details -->
            <div class="rank-badge" id="ui-rank-badge" onclick="openDetails()">B</div>
            <div class="info-stack">
                <div class="char-name" id="ui-name">Goku</div>
                <div class="power-pill">‚ö° <span id="ui-power">0</span></div>
            </div>
        </div>

        <div class="side-menu">
            <div class="side-btn" id="btn-supply" onclick="claimSupply()"><i>üéÅ</i> Supply</div>
            <div class="side-btn" onclick="openStrategy()"><i>üíä</i> Strategy</div>
            <div class="side-btn soul-btn-container" id="btn-soul" onclick="SoulSystem.openModal()">
                <div class="soul-progress-ring" id="soul-ring"></div>
                <div class="soul-content">
                    <div style="font-size:0.6rem; color:#00ffff;">SOUL</div>
                    <div id="soul-btn-pct" style="font-weight:bold; font-size:0.8rem;">0%</div>
                    <div id="soul-btn-lvl" style="font-size:0.6rem; color:#aaa;">Lv.1</div>
                </div>
            </div>
            <div class="side-btn" id="btn-rebirth"><i>‚ôªÔ∏è</i> Rebirth</div>
        </div>

        <div class="gacha-view" id="hub-view-container" onclick="tapTrain()">
            <div id="hub-arena"></div>
        </div>

        <div class="bottom-panel">
            <div class="panel-header">
                <div class="lvl-badge">LV <span id="ui-lvl">1</span></div>
                <div style="flex:1; margin: 0 15px;">
                    <div style="font-size:0.7rem; color:#777; margin-bottom:2px;">EXP PROGRESS</div>
                    <div class="bar-wrap" style="height:8px; background:#bdc3c7;"><div id="bar-xp" class="bar-fill xp-f"></div></div>
                </div>
                <div class="coin-display">üí∞ <span id="ui-coins">0</span></div>
            </div>

            <div class="stats-container">
                <div class="stats-col">
                    <div class="stat-row"><span class="stat-icon">‚ù§Ô∏è</span> <span id="ui-hp-txt">500</span></div>
                    <div class="stat-row"><span class="stat-icon">‚öîÔ∏è</span> <span id="ui-atk">40</span> <small style="color:#27ae60; cursor:pointer;" onclick="train('atk')">[+]</small></div>
                    <div class="stat-row"><span class="stat-icon">üõ°Ô∏è</span> <span id="ui-def">25</span> <small style="color:#27ae60; cursor:pointer;" onclick="train('def')">[+]</small></div>
                </div>
                <div class="equip-slots">
                    <div class="slot-box" id="slot-w"><span>‚öîÔ∏è</span><div class="slot-label">WEAPON</div></div>
                    <div class="slot-box" id="slot-a"><span>üõ°Ô∏è</span><div class="slot-label">ARMOR</div></div>
                </div>
            </div>

            <button class="action-btn" id="btn-action" onclick="doEquip()"><span>EQUIP SELECTED</span></button>
            <button class="action-btn" id="btn-merge" style="display:none; background: linear-gradient(to bottom, #8e44ad, #9b59b6);" onclick="mergeItems()"><span>MERGE (3)</span></button>

            <div style="font-size:0.75rem; color:#777; margin-bottom:5px; display:flex; justify-content:space-between;">
                <span>GEAR INVENTORY</span><span style="font-size:0.7rem;">Tap to Select</span>
            </div>
            <div id="inv-grid" class="inv-scroll"></div>

            <div class="bot-nav">
                <div class="nav-icon" onclick="train('atk')"><div class="nav-circle" style="color:#e74c3c;">üí™</div>Training</div>
                <div class="nav-icon" onclick="Skills.openSkillScreen()"><div class="nav-circle" style="color:#f1c40f;">üåü</div>Skills</div>
                <div class="nav-icon" onclick="GearSystem.open()"><div class="nav-circle" style="color:#3498db;">üéí</div>Gear</div>
                <div class="nav-icon"><div class="nav-circle" style="color:#9b59b6;">‚¨ÜÔ∏è</div>Advance</div>
            </div>
        </div>
    </div>

    <!-- BATTLE SCREEN -->
    <div id="view-battle" class="screen">
        <div class="battle-overlay"></div>
        <div id="cutin-overlay"><img id="cutin-img" src="" alt="Special Attack"></div>
        <div id="battle-menu">
            <div id="menu-title" style="color:var(--dbz-yellow); font-family:'Bangers'; font-size:3rem; margin-bottom:10px;">VICTORY!</div>
            <div style="width:80%; margin-bottom:15px;">
                <div style="display:flex; justify-content:space-between; color:white; font-family:'Orbitron'; font-size:0.8rem;">
                    <span>LV <span id="r-lvl">1</span></span>
                    <span id="r-xp-text">0 / 100</span>
                </div>
                <div class="bar-wrap" style="height:10px; background:#444; margin-top:5px;"><div id="r-bar-xp" class="bar-fill xp-f"></div></div>
            </div>
            <div class="rewards-box">
                <div class="reward-row">XP GAINED: <span id="r-xp" class="reward-val">0</span></div>
                <div class="reward-row">COINS: <span id="r-coins" class="reward-val">0</span></div>
                <div class="reward-row">DROPS: <span id="r-drops" style="color:cyan; font-size:0.8rem;">NONE</span></div>
            </div>
            <button class="menu-btn" onclick="autoStartNext()">NEXT STAGE (<span id="auto-timer">3</span>)</button>
            <button class="menu-btn exit" onclick="exitBattle()">EXIT</button>
        </div>
        <div class="stage-selector" id="ui-stage-selector"></div>
        <div id="start-prompt">SELECT A STAGE<br>TO BEGIN FIGHT!</div>
        <div class="arena">
            <div id="fx-beam" class="beam"></div>
            <img id="fx-beam" class="beam" src="hb_b.png" alt="Energy Beam">
            <div class="unit" id="p-box">
                <div class="bar-wrap" style="height:10px; margin-bottom: 2px;"><div id="btl-p-hp" class="bar-fill hp-f" style="width:100%"></div></div>
                <div class="bar-wrap" style="height:6px; border-color: gold; margin-top:0;"><div id="btl-p-charge" class="bar-fill charge-f" style="width:0%"></div></div>
                <img id="btl-p-sprite" src="IMG_0054.png" alt="Player Goku">
                <div style="font-family:'Bangers'; font-size:1rem; margin-top:5px;">GOKU</div>
            </div>
            <div class="unit" id="e-box">
                <div class="bar-wrap" style="height:10px;"><div id="btl-e-hp" class="bar-fill hp-f" style="width:100%"></div></div>
                <img id="e-img" src="" style="display:none;" alt="Enemy">
                <div id="e-name" style="font-family:'Bangers'; font-size:1rem; margin-top:5px; color:red; text-shadow: 1px 1px black;"></div>
            </div>
        </div>
        <div id="log">Battle Log initialized...</div>
    </div>

    <!-- MODALS -->
    <!-- Gear Overlay -->
    <div id="gear-overlay" style="display:none;">
        <div class="g-header"><h2>GEAR BACKPACK</h2><div class="g-close" id="g-close-btn">‚úï</div></div>
        <div class="g-content"><p style="font-size: 0.7rem; color: #888; margin-bottom: 10px;">Tap an item to manage...</p><div class="g-grid" id="gear-list"></div></div>
        <div class="g-footer"><div class="g-preview-box"><div id="g-display-name" class="g-item-name">EMPTY SLOT</div><div id="g-display-stats" class="g-item-stats">Select item to view potential power...</div></div><div class="g-btn-row"><button id="g-details-btn" class="g-btn g-btn-blue" disabled>DETAILS</button><button id="g-sell-btn" class="g-btn g-btn-green" disabled>SELL ITEM</button></div></div>
    </div>
    <div id="g-modal" style="display:none;"><h3 id="gm-name" style="font-family:'Bangers'; color:#2c3e50; font-size:1.8rem;"></h3><div id="gm-body" style="font-size:0.9rem; margin-bottom:20px;"></div><div id="gm-price" style="color:#27ae60; font-weight:bold; margin-bottom:20px;"></div><button id="g-modal-close" class="g-btn g-btn-blue" style="width:100%">GOT IT</button></div>

    <!-- Skills Overlay -->
    <div id="skills-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:9999; color:#fff; flex-direction:column; overflow-y:auto;">
        <div class="g-header" style="background:transparent; border:none; box-shadow:none;"><h1 style="color:var(--dbz-orange);">üî• SKILLS üî•</h1><div class="g-close" onclick="Skills.closeSkillScreen()" style="color:#fff;">‚úï</div></div><div id="skills-list-container" style="padding:20px; max-width:800px; margin:0 auto; width:100%;"></div><button class="g-btn g-btn-blue" style="margin:20px auto; width:80%; max-width:300px;" onclick="Skills.closeSkillScreen()">CLOSE</button>
    </div>
    
    <!-- Strategy Modal -->
    <div id="strategy-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:2000; flex-direction:column; align-items:center; justify-content:center;">
        <div style="width:90%; max-width:400px; background:linear-gradient(135deg, #2c3e50, #000); border:2px solid #00d2ff; border-radius:15px; padding:20px; text-align:center; box-shadow:0 0 20px #00d2ff; position:relative;">
            <div style="font-family:'Bangers'; color:#00d2ff; font-size:2.5rem; margin-bottom:10px; text-shadow:2px 2px black;">GRAVITRON CHAMBER</div>
            <div id="grav-anim" style="height:120px; display:flex; align-items:center; justify-content:center; margin:20px 0;"><div class="grav-spinner"><span style="font-size:3rem;">üíä</span></div></div>
            <div style="font-family:'Orbitron'; color:white; font-size:0.9rem; margin-bottom:5px;">TIME IN CHAMBER: <span id="strat-time" style="color:yellow;">0</span> MINS</div>
            <div style="font-family:'Orbitron'; color:white; font-size:0.9rem; margin-bottom:20px;">GRAVITY MULTIPLIER: <span id="strat-mult" style="color:red;">x1</span></div>
            <div style="background:rgba(0,0,0,0.5); padding:15px; border-radius:10px; border:1px solid #555; margin-bottom:20px;"><div style="font-family:'Orbitron'; font-size:0.8rem; color:#aaa;">TRAINING RESULTS</div><div id="strat-xp-display" style="font-family:'Bangers'; font-size:2rem; color:#00ff00; text-shadow:2px 2px black;">0 XP</div><div id="strat-gold-display" style="font-family:'Bangers'; font-size:1.5rem; color:#f1c40f; text-shadow:1px 1px black;">0 COINS</div><div id="strat-item-display" style="font-family:'Orbitron'; font-size:0.8rem; color:#00d2ff; margin-top:5px;">No Items Found</div></div>
            <button id="btn-claim-strat" onclick="claimStrategy()" style="width:100%; padding:15px; background:linear-gradient(to bottom, #27ae60, #2ecc71); border:none; border-radius:8px; color:white; font-family:'Bangers'; font-size:1.5rem; cursor:pointer; text-shadow:1px 1px black;">CLAIM REWARDS</button>
            <button onclick="closeStrategy()" style="margin-top:15px; background:transparent; border:none; color:#777; font-family:'Orbitron'; cursor:pointer; font-size:0.8rem;">LEAVE CHAMBER (NO CLAIM)</button>
        </div>
    </div>

    <!-- Soul Modal -->
    <div id="soul-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; flex-direction:column; align-items:center; justify-content:center;">
        <div style="width:90%; max-width:400px; background:#1a1a1a; border:2px solid #e74c3c; border-radius:15px; padding:20px; box-shadow:0 0 25px rgba(231,76,60,0.5); color:white; font-family:'Orbitron'; position:relative;">
            <div class="g-close" onclick="SoulSystem.closeModal()" style="position:absolute; top:10px; right:15px; color:#aaa;">‚úï</div>
            <div style="text-align:center; border-bottom:1px solid #444; padding-bottom:10px; margin-bottom:15px;"><div style="color:#e74c3c; font-size:0.8rem;">SOUL STONE LEVEL</div><div id="sm-level" style="font-family:'Bangers'; font-size:2.5rem; color:white;">Lv.1</div></div>
            <div style="display:flex; justify-content:space-around; margin-bottom:20px;"><div style="text-align:center;"><div class="grav-spinner" style="width:80px; height:80px; border-color:#00ffff; box-shadow:0 0 10px #00ffff;"><span id="sm-pct" style="font-size:1.2rem; font-weight:bold;">0%</span></div></div><div style="flex:1; margin-left:15px;"><div style="font-size:0.8rem; color:#aaa;">SOUL ABILITIES</div><div id="sm-stats" style="font-size:0.75rem; line-height:1.6; margin-top:5px; color:#00d2ff;"></div></div></div>
            <button id="btn-liberate" onclick="SoulSystem.liberate()" style="width:100%; padding:15px; background:#444; border:none; border-radius:8px; color:#777; font-family:'Bangers'; font-size:1.5rem; cursor:default;">SOUL LIBERATION</button>
            <div id="sm-req" style="text-align:center; font-size:0.7rem; color:#555; margin-top:5px;">Requires 100% Soul Gauge</div>
        </div>
    </div>

    <!-- NEW DETAILS MODAL -->
    <div id="details-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:3000; flex-direction:column; align-items:center; justify-content:center;">
        <div style="width:90%; max-width:400px; background:#111; border:2px solid #aaa; border-radius:15px; padding:0; overflow:hidden; box-shadow:0 0 30px black;">
            <div style="background:#222; padding:15px; border-bottom:1px solid #444; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-family:'Bangers'; font-size:1.5rem; color:white;">BATTLE STATS</span>
                <span onclick="closeDetails()" style="color:#aaa; font-size:1.5rem; cursor:pointer;">‚úï</span>
            </div>
            <div style="padding:20px; font-family:'Orbitron'; font-size:0.9rem; color:#ddd;">
                <div class="stat-row"><span>üî• Total Power</span><span id="det-power" style="color:var(--dbz-yellow)">0</span></div>
                <div class="stat-row"><span>‚ù§Ô∏è Max HP</span><span id="det-hp" style="color:#ff3e3e">0</span></div>
                <hr style="border-color:#333; margin:10px 0;">
                <div class="stat-row"><span>‚öîÔ∏è Attack</span><span id="det-atk">0</span></div>
                <div class="stat-row"><span>üõ°Ô∏è Defense</span><span id="det-def">0</span></div>
                <div class="stat-row"><span>‚ö° Crit Chance</span><span id="det-crit">0%</span></div>
                <hr style="border-color:#333; margin:10px 0;">
                <div class="stat-row"><span>üíé Soul Boost</span><span id="det-soul" style="color:#00ffff">x1.0</span></div>
                <div class="stat-row"><span>üí∞ Coins</span><span id="det-coins" style="color:#f1c40f">0</span></div>
            </div>
        </div>
    </div>

</body>
</html>
